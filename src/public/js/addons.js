"use strict";class Addon{constructor(a,b){this.el=$(a),this.ops=b,Addon.log(`Addons args of ${b.app}:`,{color:"aqua",data:{el:a,args:b}})}currentTarget(a){return $(a.currentTarget)}static observeMutations(a,b){const c=new MutationObserver(()=>{for(let c in a)document.querySelectorAll(`[class*='js-${c}--'], [data-js-${c}], .js-app--${c}`).forEach(d=>{$(d).data(c)||$(d).data(c,new a[c](d,{app:c,...b}))})});c.observe(document.body,{childList:!0,subtree:!0})}static isLocal(){return-1!==location.host.indexOf("localhost")||-1!==location.host.indexOf("dev")}static log(a,b){b=b||{};let{fn:c,color:d,data:e}=b;c=c||"log",d=d||"#bada55",e=e||"",Addon.isLocal()&&console[c](`%c ${a}`,`background: #222; color: ${d}`,e)}log(a,b="log"){Addon.log(a,{fn:b})}}
"use strict";class GoogleTagManager extends Addon{constructor(a,b){super(a,b),this.prefixes={action:"js-gtm--btn-cta-"},this.events()}currentTarget(a){return $(a.currentTarget)}handleCta(a){a.stopPropagation(),this.event="cta";const b=this.currentTarget(a).attr("class"),c=b.indexOf(this.prefixes.action);if(-1!==c){const d=b.substr(c).split(" "),e=d[0].split(this.prefixes.action)[1];// remove anything after
let f=this.currentTarget(a).attr("data-gtm-info");"search"===e.toLowerCase()&&(f="keyword: "+this.currentTarget(a).parents(".c-search").find("input").val()),e&&e.length&&this.gtm({action:e,info:f})}}handleFilter(a){if(this.event="filter",this.currentTarget(a).is(":checked")){const b=this.currentTarget(a).parents(".ant-dropdown-menu-title-content").find("> span").text();this.gtm({filter:b})}}handleMenuItem(a){a.stopPropagation(),this.event="cta";const b=this.currentTarget(a).text();"Submit For Processing"===b&&this.gtm({filter:"initiate-submit-for-processing"})}handleModalCta(a){this.event="cta";const b=this.currentTarget(a).text();"Submit"===b&&this.gtm({filter:"submit-for-processing"})}events(){const a=this;$("body").on("click",`[class*="${this.prefixes.action}"]`,b=>{b.stopImmediatePropagation(),a.handleCta(b)}),$("body").on("change",".ant-table-filter-dropdown .ant-checkbox-input",b=>{b.stopImmediatePropagation(),a.handleFilter(b)}),$("body").on("click",".ant-dropdown-menu-item .ant-dropdown-menu-title-content",b=>{b.stopImmediatePropagation(),a.handleMenuItem(b)}),$("body").on("click",".ant-modal-footer .ant-btn-primary",b=>{b.stopImmediatePropagation(),a.handleModalCta(b)})}getPath(){const a=window.location.href;return 70<a.length?window.location.pathname:a}hasUser(){return null!==this.ops?.email}getContext(){return this.hasUser()?window.location.href.includes("entity_type=uploads")?"uploads":"/usage"==window.location.pathname?"usage":"datasets":null}getPerson(a=!1){if(!this.hasUser())return"anonymous";const b=this.ops.email;let c;return b&&(c=a?btoa(b.replace("@","*")):`${b.split("@")[0]}***`),c}gtm(a){let b={event:this.event,context:this.getContext(),path:this.getPath(),person:this.getPerson(),user_id:this.getPerson(!0),...a};console.log(b),dataLayer.push(b)}}
